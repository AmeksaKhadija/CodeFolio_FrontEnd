{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nimport { getToken } from '../utils/token';\nimport { login as loginService, logout as logoutService } from '../services/auth';\nimport client from '../apollo/client';\nimport { LOGIN_MUTATION } from '../api/mutations';\nexport const useAuth = () => {\n  _s();\n  const {\n    user,\n    setUser\n  } = useContext(AuthContext);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const token = getToken();\n    // si token existe, tu peux décoder ou récupérer le user côté serveur\n    // pour l'instant, on ne modifie pas setUser automatiquement\n    setLoading(false);\n  }, [setUser]);\n  const login = async (email, password) => {\n    setLoading(true);\n    setError(null);\n    try {\n      var _result$data;\n      // Utiliser Apollo client pour appeler la mutation GraphQL\n      const result = await client.mutate({\n        mutation: LOGIN_MUTATION,\n        variables: {\n          email,\n          password\n        }\n      });\n      const payload = result === null || result === void 0 ? void 0 : (_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.login;\n      if (!payload || !payload.token) {\n        throw new Error('No token returned from login mutation');\n      }\n      // sauvegarder le token et le user\n      // setToken(payload.token);\n      setUser(payload.user || null);\n      return payload;\n    } catch (err) {\n      console.error('useAuth.login error', err);\n      setError(err);\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n  const logout = () => {\n    logoutService();\n    setUser(null);\n  };\n  const isAuthenticated = !!getToken();\n  return {\n    user,\n    setUser,\n    login,\n    logout,\n    loading,\n    error,\n    isAuthenticated\n  };\n};\n_s(useAuth, \"HD2Y11IIY7zb35MDymtl2y/dxnQ=\");\nexport default useAuth;","map":{"version":3,"names":["useContext","useEffect","useState","AuthContext","getToken","login","loginService","logout","logoutService","client","LOGIN_MUTATION","useAuth","_s","user","setUser","loading","setLoading","error","setError","token","email","password","_result$data","result","mutate","mutation","variables","payload","data","Error","err","console","isAuthenticated"],"sources":["C:/Users/Youcode/Desktop/2ème annèe/codefolio-react-app/src/hooks/useAuth.js"],"sourcesContent":["import { useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nimport { getToken } from '../utils/token';\nimport { login as loginService, logout as logoutService } from '../services/auth';\nimport client from '../apollo/client';\nimport { LOGIN_MUTATION } from '../api/mutations';\n\nexport const useAuth = () => {\n    const { user, setUser } = useContext(AuthContext);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        const token = getToken();\n        // si token existe, tu peux décoder ou récupérer le user côté serveur\n        // pour l'instant, on ne modifie pas setUser automatiquement\n        setLoading(false);\n    }, [setUser]);\n\n    const login = async (email, password) => {\n        setLoading(true);\n        setError(null);\n        try {\n            // Utiliser Apollo client pour appeler la mutation GraphQL\n            const result = await client.mutate({\n                mutation: LOGIN_MUTATION,\n                variables: { email, password },\n            });\n            const payload = result?.data?.login;\n            if (!payload || !payload.token) {\n                throw new Error('No token returned from login mutation');\n            }\n            // sauvegarder le token et le user\n            // setToken(payload.token);\n            setUser(payload.user || null);\n            return payload;\n        } catch (err) {\n            console.error('useAuth.login error', err);\n            setError(err);\n            throw err;\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const logout = () => {\n        logoutService();\n        setUser(null);\n    };\n\n    const isAuthenticated = !!getToken();\n\n    return { user, setUser, login, logout, loading, error, isAuthenticated };\n};\n\nexport default useAuth;"],"mappings":";AAAA,SAASA,UAAU,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACvD,SAASC,WAAW,QAAQ,wBAAwB;AACpD,SAASC,QAAQ,QAAQ,gBAAgB;AACzC,SAASC,KAAK,IAAIC,YAAY,EAAEC,MAAM,IAAIC,aAAa,QAAQ,kBAAkB;AACjF,OAAOC,MAAM,MAAM,kBAAkB;AACrC,SAASC,cAAc,QAAQ,kBAAkB;AAEjD,OAAO,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACzB,MAAM;IAAEC,IAAI;IAAEC;EAAQ,CAAC,GAAGd,UAAU,CAACG,WAAW,CAAC;EACjD,MAAM,CAACY,OAAO,EAAEC,UAAU,CAAC,GAAGd,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACe,KAAK,EAAEC,QAAQ,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EAExCD,SAAS,CAAC,MAAM;IACZ,MAAMkB,KAAK,GAAGf,QAAQ,CAAC,CAAC;IACxB;IACA;IACAY,UAAU,CAAC,KAAK,CAAC;EACrB,CAAC,EAAE,CAACF,OAAO,CAAC,CAAC;EAEb,MAAMT,KAAK,GAAG,MAAAA,CAAOe,KAAK,EAAEC,QAAQ,KAAK;IACrCL,UAAU,CAAC,IAAI,CAAC;IAChBE,QAAQ,CAAC,IAAI,CAAC;IACd,IAAI;MAAA,IAAAI,YAAA;MACA;MACA,MAAMC,MAAM,GAAG,MAAMd,MAAM,CAACe,MAAM,CAAC;QAC/BC,QAAQ,EAAEf,cAAc;QACxBgB,SAAS,EAAE;UAAEN,KAAK;UAAEC;QAAS;MACjC,CAAC,CAAC;MACF,MAAMM,OAAO,GAAGJ,MAAM,aAANA,MAAM,wBAAAD,YAAA,GAANC,MAAM,CAAEK,IAAI,cAAAN,YAAA,uBAAZA,YAAA,CAAcjB,KAAK;MACnC,IAAI,CAACsB,OAAO,IAAI,CAACA,OAAO,CAACR,KAAK,EAAE;QAC5B,MAAM,IAAIU,KAAK,CAAC,uCAAuC,CAAC;MAC5D;MACA;MACA;MACAf,OAAO,CAACa,OAAO,CAACd,IAAI,IAAI,IAAI,CAAC;MAC7B,OAAOc,OAAO;IAClB,CAAC,CAAC,OAAOG,GAAG,EAAE;MACVC,OAAO,CAACd,KAAK,CAAC,qBAAqB,EAAEa,GAAG,CAAC;MACzCZ,QAAQ,CAACY,GAAG,CAAC;MACb,MAAMA,GAAG;IACb,CAAC,SAAS;MACNd,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC;EAED,MAAMT,MAAM,GAAGA,CAAA,KAAM;IACjBC,aAAa,CAAC,CAAC;IACfM,OAAO,CAAC,IAAI,CAAC;EACjB,CAAC;EAED,MAAMkB,eAAe,GAAG,CAAC,CAAC5B,QAAQ,CAAC,CAAC;EAEpC,OAAO;IAAES,IAAI;IAAEC,OAAO;IAAET,KAAK;IAAEE,MAAM;IAAEQ,OAAO;IAAEE,KAAK;IAAEe;EAAgB,CAAC;AAC5E,CAAC;AAACpB,EAAA,CA9CWD,OAAO;AAgDpB,eAAeA,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module"}