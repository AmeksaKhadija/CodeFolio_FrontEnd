{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nimport { getToken, setToken } from '../utils/token';\nimport { logout as logoutService } from '../services/auth';\nimport client from '../apollo/client';\nimport { LOGIN_MUTATION } from '../api/mutations';\nexport const useAuth = () => {\n  _s();\n  const {\n    user,\n    setUser\n  } = useContext(AuthContext);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const token = getToken();\n    if (token) {\n      // optionnel : décoder token ou récupérer user\n    }\n    setLoading(false);\n  }, [setUser]);\n  const login = async (email, password) => {\n    setLoading(true);\n    setError(null);\n    try {\n      var _result$data;\n      const result = await client.mutate({\n        mutation: LOGIN_MUTATION,\n        variables: {\n          username,\n          email,\n          password\n        }\n      });\n      const payload = result === null || result === void 0 ? void 0 : (_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.login;\n      if (!payload || !payload.token) {\n        var _result$errors, _result$errors$;\n        const msg = (result === null || result === void 0 ? void 0 : (_result$errors = result.errors) === null || _result$errors === void 0 ? void 0 : (_result$errors$ = _result$errors[0]) === null || _result$errors$ === void 0 ? void 0 : _result$errors$.message) || 'No token returned';\n        throw new Error(msg);\n      }\n      setToken(payload.token); // sauvegarde du token\n      setUser(payload.user || null);\n      return payload;\n    } catch (err) {\n      console.error('useAuth.login error', err);\n      setError(err);\n      throw err;\n    } finally {\n      setLoading(false);\n    }\n  };\n  const logout = () => {\n    logoutService();\n    setUser(null);\n  };\n  const isAuthenticated = !!getToken();\n  return {\n    user,\n    setUser,\n    login,\n    logout,\n    loading,\n    error,\n    isAuthenticated\n  };\n};\n_s(useAuth, \"HD2Y11IIY7zb35MDymtl2y/dxnQ=\");\nexport default useAuth;","map":{"version":3,"names":["useContext","useEffect","useState","AuthContext","getToken","setToken","logout","logoutService","client","LOGIN_MUTATION","useAuth","_s","user","setUser","loading","setLoading","error","setError","token","login","email","password","_result$data","result","mutate","mutation","variables","username","payload","data","_result$errors","_result$errors$","msg","errors","message","Error","err","console","isAuthenticated"],"sources":["C:/Users/Youcode/Desktop/2ème annèe/codefolio-react-app/src/hooks/useAuth.js"],"sourcesContent":["import { useContext, useEffect, useState } from 'react';\nimport { AuthContext } from '../context/AuthContext';\nimport { getToken, setToken } from '../utils/token';\nimport { logout as logoutService } from '../services/auth';\nimport client from '../apollo/client';\nimport { LOGIN_MUTATION } from '../api/mutations';\n\nexport const useAuth = () => {\n    const { user, setUser } = useContext(AuthContext);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(null);\n\n    useEffect(() => {\n        const token = getToken();\n        if (token) {\n            // optionnel : décoder token ou récupérer user\n        }\n        setLoading(false);\n    }, [setUser]);\n\n    const login = async (email, password) => {\n        setLoading(true);\n        setError(null);\n        try {\n            const result = await client.mutate({\n                mutation: LOGIN_MUTATION,\n                variables: {username, email, password },\n            });\n            const payload = result?.data?.login;\n            if (!payload || !payload.token) {\n                const msg = result?.errors?.[0]?.message || 'No token returned';\n                throw new Error(msg);\n            }\n            setToken(payload.token); // sauvegarde du token\n            setUser(payload.user || null);\n            return payload;\n        } catch (err) {\n            console.error('useAuth.login error', err);\n            setError(err);\n            throw err;\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const logout = () => {\n        logoutService();\n        setUser(null);\n    };\n\n    const isAuthenticated = !!getToken();\n\n    return { user, setUser, login, logout, loading, error, isAuthenticated };\n};\n\nexport default useAuth;"],"mappings":";AAAA,SAASA,UAAU,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACvD,SAASC,WAAW,QAAQ,wBAAwB;AACpD,SAASC,QAAQ,EAAEC,QAAQ,QAAQ,gBAAgB;AACnD,SAASC,MAAM,IAAIC,aAAa,QAAQ,kBAAkB;AAC1D,OAAOC,MAAM,MAAM,kBAAkB;AACrC,SAASC,cAAc,QAAQ,kBAAkB;AAEjD,OAAO,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACzB,MAAM;IAAEC,IAAI;IAAEC;EAAQ,CAAC,GAAGb,UAAU,CAACG,WAAW,CAAC;EACjD,MAAM,CAACW,OAAO,EAAEC,UAAU,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACc,KAAK,EAAEC,QAAQ,CAAC,GAAGf,QAAQ,CAAC,IAAI,CAAC;EAExCD,SAAS,CAAC,MAAM;IACZ,MAAMiB,KAAK,GAAGd,QAAQ,CAAC,CAAC;IACxB,IAAIc,KAAK,EAAE;MACP;IAAA;IAEJH,UAAU,CAAC,KAAK,CAAC;EACrB,CAAC,EAAE,CAACF,OAAO,CAAC,CAAC;EAEb,MAAMM,KAAK,GAAG,MAAAA,CAAOC,KAAK,EAAEC,QAAQ,KAAK;IACrCN,UAAU,CAAC,IAAI,CAAC;IAChBE,QAAQ,CAAC,IAAI,CAAC;IACd,IAAI;MAAA,IAAAK,YAAA;MACA,MAAMC,MAAM,GAAG,MAAMf,MAAM,CAACgB,MAAM,CAAC;QAC/BC,QAAQ,EAAEhB,cAAc;QACxBiB,SAAS,EAAE;UAACC,QAAQ;UAAEP,KAAK;UAAEC;QAAS;MAC1C,CAAC,CAAC;MACF,MAAMO,OAAO,GAAGL,MAAM,aAANA,MAAM,wBAAAD,YAAA,GAANC,MAAM,CAAEM,IAAI,cAAAP,YAAA,uBAAZA,YAAA,CAAcH,KAAK;MACnC,IAAI,CAACS,OAAO,IAAI,CAACA,OAAO,CAACV,KAAK,EAAE;QAAA,IAAAY,cAAA,EAAAC,eAAA;QAC5B,MAAMC,GAAG,GAAG,CAAAT,MAAM,aAANA,MAAM,wBAAAO,cAAA,GAANP,MAAM,CAAEU,MAAM,cAAAH,cAAA,wBAAAC,eAAA,GAAdD,cAAA,CAAiB,CAAC,CAAC,cAAAC,eAAA,uBAAnBA,eAAA,CAAqBG,OAAO,KAAI,mBAAmB;QAC/D,MAAM,IAAIC,KAAK,CAACH,GAAG,CAAC;MACxB;MACA3B,QAAQ,CAACuB,OAAO,CAACV,KAAK,CAAC,CAAC,CAAC;MACzBL,OAAO,CAACe,OAAO,CAAChB,IAAI,IAAI,IAAI,CAAC;MAC7B,OAAOgB,OAAO;IAClB,CAAC,CAAC,OAAOQ,GAAG,EAAE;MACVC,OAAO,CAACrB,KAAK,CAAC,qBAAqB,EAAEoB,GAAG,CAAC;MACzCnB,QAAQ,CAACmB,GAAG,CAAC;MACb,MAAMA,GAAG;IACb,CAAC,SAAS;MACNrB,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC;EAED,MAAMT,MAAM,GAAGA,CAAA,KAAM;IACjBC,aAAa,CAAC,CAAC;IACfM,OAAO,CAAC,IAAI,CAAC;EACjB,CAAC;EAED,MAAMyB,eAAe,GAAG,CAAC,CAAClC,QAAQ,CAAC,CAAC;EAEpC,OAAO;IAAEQ,IAAI;IAAEC,OAAO;IAAEM,KAAK;IAAEb,MAAM;IAAEQ,OAAO;IAAEE,KAAK;IAAEsB;EAAgB,CAAC;AAC5E,CAAC;AAAC3B,EAAA,CA9CWD,OAAO;AAgDpB,eAAeA,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module"}